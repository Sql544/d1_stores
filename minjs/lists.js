"use strict";require(["../js/config"],function(){require(["jquery","test","common","jquery_ui","goods","head"],function(e){function t(){e(".goods_num_btn a").click(function(){0==e(this).index()?e(this).get(0).parentNode.previousElementSibling.children[0].value++:2==e(this).index()&&e(this).get(0).parentNode.previousElementSibling.children[0].value>1&&e(this).get(0).parentNode.previousElementSibling.children[0].value--})}function i(){e(".shoptitle").each(function(){"价格"==e(this).text().trim()&&($price=e(this).siblings().find("a"))}),$price.click(function(){var t=e(this).text(),i=0;if(-1!=t.indexOf("-"))var n=t.slice(0,t.indexOf("-")),o=t.slice(t.indexOf("-")+1);else var s=parseInt(t);e(".shop_list li").find(".my_price").each(function(){s?e(this).find("font").text()<s&&e(this).get(0).parentNode.parentNode.parentNode.remove():parseInt(e(this).find("font").text())>parseInt(o)||parseInt(e(this).find("font").text())<parseInt(n)?e(this).get(0).parentNode.parentNode.parentNode.style.display="none":(e(this).get(0).parentNode.parentNode.parentNode.style.display="block",i++),e(".pagefooter").remove()})})}function n(){var t={src:"",title:"",id:"",size:"",vipprice:"",getprice:"",num:"",total:""},i=Cookie.getCookie("loginmessage");if(0==i)n="passerby";else var n=JSON.parse(i)[0].username;e(".addintoct img").click(function(){$target_locate_box=e(this).parent().parent().parent(),t.src=$target_locate_box.find(".goods_img img").attr("src"),t.title=$target_locate_box.find(".goods_title .goods_name a").text().trim(),t.id=$target_locate_box.find(".goods_id span").text(),t.vipprice=$target_locate_box.find(".my_price font").text(),t.getprice=t.vipprice,t.num=$target_locate_box.find(".goods_incart input").val(),t.total=t.num*t.vipprice;var i=Cookie.getCookie("goods");i=JSON.parse(i),i=Array.from(i);for(r=0;r<i.length;r++)if(i[r].name==n){for(var o=0;o<i[r].goods.length;o++)if(i[r].goods[o].id==t.id){i[r].goods[o].num=parseInt(i[r].goods[o].num)+parseInt(t.num),i[r].goods[o].total=i[r].goods[o].num*i[r].goods[o].getprice;break}0!=i[r].goods.length&&o!=i[r].goods.length||i[r].goods.push(t);break}Cookie.insertCookie("goods",JSON.stringify(i),432e3,"/"),test(),e(".insert_into_cart").css({display:"block",top:e(window).height()/2+e(window).scrollTop()+"px"});for(r=0;r<i.length;r++)if(i[r].name==n){var s=i[r].goods;break}var a=0,l=0;for(var r in s)l+=parseInt(s[r].total),a+=parseInt(s[r].num);e(".hint_message span").first().text(a),e(".hint_message span").last().text(l)})}function o(){e(".btn_close").click(function(){e(".insert_into_cart").css({display:"none"})}),e(".continueShopping").click(function(){e(".insert_into_cart").css({display:"none"})})}function s(t){var i=document.createElement("a");e(".pagefooter").append(i),i.innerText="首页",i.href="#",i.style.display="none";var n=document.createElement("a");e(".pagefooter").append(n),n.innerText="上一页",n.href="#",n.style.display="none";var o=document.createElement("a");e(".pagefooter").append(o),o.innerText=1,o.className="curr",o.href="#";for(var s=1;s<t;s++){var a=document.createElement("a");e(".pagefooter").append(a),a.innerText=s+1,a.href="#"}var l=document.createElement("a");e(".pagefooter").append(l),l.innerText="下一页",l.href="#";var r=document.createElement("a");e(".pagefooter").append(r),r.innerText="尾页",r.href="#",e(".pagefooter a").click(function(){1==e(this).text()?(n.style.display="none",i.style.display="none",l.style.display="inline-block",r.style.display="inline-block"):e(this).text()==t?(n.style.display="inline-block",i.style.display="inline-block",l.style.display="none",r.style.display="none"):(n.style.display="inline-block",i.style.display="inline-block",l.style.display="inline-block",r.style.display="inline-block");var o=e(this).text();$cilick=e(this),"首页"==o?(o=1,$cilick=e(".pagefooter a").eq(2)):"尾页"==o?(o=t,$cilick=e(".pagefooter a").eq(1+t)):"上一页"==o?(o=e(".curr").text()-1,$cilick=e(".pagefooter a").eq(e(".curr").index()-2)):"下一页"==o&&(o=parseInt(e(".curr").text())+1,$cilick=e(".pagefooter a").eq(e(".curr").index())),1==$cilick.text()?(n.style.display="none",i.style.display="none",l.style.display="inline-block",r.style.display="inline-block"):$cilick.text()==t&&(n.style.display="inline-block",i.style.display="inline-block",l.style.display="none",r.style.display="none"),e(".pagefooter font").eq(1).text($cilick.text()),parseInt(o)&&($cilick.addClass("curr").siblings().removeClass("curr"),e(".shop_list li").each(function(){e(this).index()>=20*o||e(this).index()<20*(o-1)?e(this).css({display:"none"}):e(this).css({display:"block"})}))})}(e=jQuery)("#head_insert").load("head.html",function(){setTimeout(function(){test()},300)}),e("#footer_insert").load("footer.html"),e(function(){jsonp("/Jsonp/Jsonp.js");jsonp_goods("/Jsonp/goodsJsonp.js");setTimeout(function(){i(),e(".shop_list li").each(function(){e(this).index()>=20&&e(this).css({display:"none"})}),t();var a=Math.ceil(e(".shop_list li").length/20);s(a),e(".pagefooter font").eq(0).text(a),n(),o()},300)})})});